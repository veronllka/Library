<Window x:Class="Library.Views.DatabaseAdministrationWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:mah="http://metro.mahapps.com/winfx/xaml/controls"
        xmlns:iconPacks="http://metro.mahapps.com/winfx/xaml/iconpacks"
        Title="Администрирование MS SQL Server" Height="800" Width="1200"
        WindowStartupLocation="CenterScreen"
        Style="{DynamicResource MahApps.Styles.Window}"
        ResizeMode="CanResize"
        MinHeight="600" MinWidth="900">

    <Window.Resources>
        <!-- Стили для кнопок -->
        <Style x:Key="AdminButton" TargetType="Button" BasedOn="{StaticResource MahApps.Styles.Button}">
            <Setter Property="Margin" Value="5"/>
            <Setter Property="Padding" Value="10,8"/>
            <Setter Property="FontSize" Value="14"/>
            <Setter Property="Height" Value="40"/>
            <Setter Property="Background" Value="#4CAF50"/>
            <Setter Property="Foreground" Value="White"/>
            <Setter Property="BorderBrush" Value="#45A049"/>
            <Setter Property="Cursor" Value="Hand"/>
        </Style>

        <Style x:Key="DangerButton" TargetType="Button" BasedOn="{StaticResource AdminButton}">
            <Setter Property="Background" Value="#F44336"/>
            <Setter Property="BorderBrush" Value="#D32F2F"/>
        </Style>

        <Style x:Key="InfoButton" TargetType="Button" BasedOn="{StaticResource AdminButton}">
            <Setter Property="Background" Value="#2196F3"/>
            <Setter Property="BorderBrush" Value="#1976D2"/>
        </Style>
    </Window.Resources>

    <Grid>
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
            <RowDefinition Height="Auto"/>
        </Grid.RowDefinitions>

        <!-- Заголовок -->
        <Border Grid.Row="0" Background="#2E3440" Padding="20,15">
            <StackPanel Orientation="Horizontal">
                <iconPacks:PackIconMaterial Kind="Database" 
                                            Width="32" Height="32" 
                                            Foreground="#81C784" 
                                            Margin="0,0,15,0"/>
                <StackPanel>
                    <TextBlock Text="Администрирование MS SQL Server" 
                               FontSize="20" FontWeight="Bold" 
                               Foreground="White"/>
                    <TextBlock x:Name="ServerInfoText" 
                               Text="Сервер: WIN-IT3KG728UQJ\SQLEXPRESS | База: Library" 
                               FontSize="12" 
                               Foreground="#B0BEC5"/>
                </StackPanel>
            </StackPanel>
        </Border>

        <!-- Основное содержимое с вкладками -->
        <TabControl Grid.Row="1" 
                    Style="{DynamicResource MahApps.Styles.TabControl}"
                    Margin="10">
            
            <!-- Информация о сервере -->
            <TabItem Header="Информация о сервере">
                <Grid Margin="15">
                    <Grid.RowDefinitions>
                        <RowDefinition Height="Auto"/>
                        <RowDefinition Height="Auto"/>
                        <RowDefinition Height="*"/>
                    </Grid.RowDefinitions>

                    <!-- Кнопки управления -->
                    <WrapPanel Grid.Row="0" Margin="0,0,0,15">
                        <Button x:Name="RefreshServerInfoButton" 
                                Content="Обновить информацию" 
                                Style="{StaticResource InfoButton}"
                                Click="RefreshServerInfoButton_Click"/>
                        
                        <Button x:Name="TestConnectionButton" 
                                Content="Тест подключения" 
                                Style="{StaticResource InfoButton}"
                                Click="TestConnectionButton_Click"/>
                    </WrapPanel>

                    <!-- Статус подключения -->
                    <Border Grid.Row="1" Background="#E8F5E8" BorderBrush="#4CAF50" BorderThickness="1" 
                            CornerRadius="5" Padding="15" Margin="0,0,0,15">
                        <StackPanel>
                            <StackPanel Orientation="Horizontal" Margin="0,0,0,10">
                                <iconPacks:PackIconMaterial Kind="CheckCircle" Width="20" Height="20" 
                                                            Foreground="#4CAF50" Margin="0,0,10,0"/>
                                <TextBlock x:Name="ConnectionStatusText" 
                                           Text="Подключение активно" 
                                           FontWeight="Bold" FontSize="14" 
                                           Foreground="#2E7D32"/>
                            </StackPanel>
                            <TextBlock x:Name="LastConnectedText" 
                                       Text="Последнее подключение: Загрузка..." 
                                       FontSize="12" 
                                       Foreground="#666"/>
                        </StackPanel>
                    </Border>

                    <!-- Информация о сервере -->
                    <DataGrid x:Name="ServerInfoGrid" Grid.Row="2"
                              Style="{DynamicResource MahApps.Styles.DataGrid}"
                              AutoGenerateColumns="False" 
                              IsReadOnly="True"
                              GridLinesVisibility="Horizontal"
                              AlternatingRowBackground="#F8F9FA">
                        <DataGrid.Columns>
                            <DataGridTextColumn Header="Параметр" Binding="{Binding Parameter}" Width="200"/>
                            <DataGridTextColumn Header="Значение" Binding="{Binding Value}" Width="*"/>
                        </DataGrid.Columns>
                    </DataGrid>
                </Grid>
            </TabItem>

            <!-- Управление базами данных -->
            <TabItem Header="Базы данных">
                <Grid Margin="15">
                    <Grid.RowDefinitions>
                        <RowDefinition Height="Auto"/>
                        <RowDefinition Height="*"/>
                    </Grid.RowDefinitions>

                    <!-- Кнопки управления базами -->
                    <WrapPanel Grid.Row="0" Margin="0,0,0,15">
                        <Button x:Name="RefreshDatabasesButton" 
                                Content="Обновить список" 
                                Style="{StaticResource InfoButton}"
                                Click="RefreshDatabasesButton_Click"/>
                        
                        <Button x:Name="CreateDatabaseButton" 
                                Content="Создать БД" 
                                Style="{StaticResource AdminButton}"
                                Click="CreateDatabaseButton_Click"/>
                        
                        <Button x:Name="BackupDatabaseButton" 
                                Content="Резервная копия" 
                                Style="{StaticResource AdminButton}"
                                Click="BackupDatabaseButton_Click"/>
                        
                        <Button x:Name="RestoreDatabaseButton" 
                                Content="Восстановить БД" 
                                Style="{StaticResource AdminButton}"
                                Click="RestoreDatabaseButton_Click"/>
                    </WrapPanel>

                    <!-- Список баз данных -->
                    <DataGrid x:Name="DatabasesGrid" Grid.Row="1"
                              Style="{DynamicResource MahApps.Styles.DataGrid}"
                              AutoGenerateColumns="False" 
                              IsReadOnly="True"
                              SelectionMode="Single"
                              GridLinesVisibility="Horizontal"
                              AlternatingRowBackground="#F8F9FA">
                        <DataGrid.Columns>
                            <DataGridTextColumn Header="Название БД" Binding="{Binding Name}" Width="200"/>
                            <DataGridTextColumn Header="Размер (МБ)" Binding="{Binding SizeMB}" Width="100"/>
                            <DataGridTextColumn Header="Состояние" Binding="{Binding State}" Width="120"/>
                            <DataGridTextColumn Header="Владелец" Binding="{Binding Owner}" Width="150"/>
                            <DataGridTextColumn Header="Дата создания" Binding="{Binding CreateDate}" Width="*"/>
                        </DataGrid.Columns>
                    </DataGrid>
                </Grid>
            </TabItem>



            <!-- Безопасность -->
            <TabItem Header="Безопасность">
                <Grid Margin="15">
                    <Grid.RowDefinitions>
                        <RowDefinition Height="Auto"/>
                        <RowDefinition Height="*"/>
                    </Grid.RowDefinitions>

                    <!-- Кнопки управления -->
                    <WrapPanel Grid.Row="0" Margin="0,0,0,15">
                        <Button x:Name="RefreshSecurityButton" 
                                Content="Обновить информацию" 
                                Style="{StaticResource InfoButton}"
                                Click="RefreshSecurityButton_Click"/>
                        
                        <Button x:Name="CreateLoginButton" 
                                Content="Создать логин" 
                                Style="{StaticResource AdminButton}"
                                Click="CreateLoginButton_Click"/>
                        
                        <Button x:Name="ManagePermissionsButton" 
                                Content="Управление правами" 
                                Style="{StaticResource AdminButton}"
                                Click="ManagePermissionsButton_Click"/>

                        <Button x:Name="AuditLogButton" 
                                Content="Журнал аудита" 
                                Style="{StaticResource InfoButton}"
                                Click="AuditLogButton_Click"/>
                    </WrapPanel>

                    <!-- Вкладки безопасности -->
                    <TabControl Grid.Row="1" Style="{DynamicResource MahApps.Styles.TabControl}">
                        <!-- Логины сервера -->
                        <TabItem Header="Логины сервера">
                            <DataGrid x:Name="LoginsGrid"
                                      Style="{DynamicResource MahApps.Styles.DataGrid}"
                                      AutoGenerateColumns="False" 
                                      IsReadOnly="True"
                                      GridLinesVisibility="Horizontal"
                                      AlternatingRowBackground="#F8F9FA"
                                      Margin="10">
                                <DataGrid.Columns>
                                    <DataGridTextColumn Header="Логин" Binding="{Binding LoginName}" Width="150"/>
                                    <DataGridTextColumn Header="Тип" Binding="{Binding LoginType}" Width="120"/>
                                    <DataGridTextColumn Header="База по умолчанию" Binding="{Binding DefaultDatabase}" Width="150"/>
                                    <DataGridTextColumn Header="Создан" Binding="{Binding CreateDate}" Width="100"/>
                                    <DataGridTextColumn Header="Последний вход" Binding="{Binding LastLogin}" Width="100"/>
                                    <DataGridCheckBoxColumn Header="Активен" Binding="{Binding IsEnabled}" Width="80"/>
                                </DataGrid.Columns>
                            </DataGrid>
                        </TabItem>

                        <!-- Пользователи БД -->
                        <TabItem Header="Пользователи БД">
                            <DataGrid x:Name="DatabaseUsersGrid"
                                      Style="{DynamicResource MahApps.Styles.DataGrid}"
                                      AutoGenerateColumns="False" 
                                      IsReadOnly="True"
                                      GridLinesVisibility="Horizontal"
                                      AlternatingRowBackground="#F8F9FA"
                                      Margin="10">
                                <DataGrid.Columns>
                                    <DataGridTextColumn Header="Пользователь" Binding="{Binding UserName}" Width="150"/>
                                    <DataGridTextColumn Header="Логин" Binding="{Binding LoginName}" Width="150"/>
                                    <DataGridTextColumn Header="Роль" Binding="{Binding Role}" Width="120"/>
                                    <DataGridTextColumn Header="Схема" Binding="{Binding DefaultSchema}" Width="100"/>
                                    <DataGridTextColumn Header="Создан" Binding="{Binding CreateDate}" Width="*"/>
                                </DataGrid.Columns>
                            </DataGrid>
                        </TabItem>

                        <!-- Роли сервера -->
                        <TabItem Header="Роли сервера">
                            <DataGrid x:Name="ServerRolesGrid"
                                      Style="{DynamicResource MahApps.Styles.DataGrid}"
                                      AutoGenerateColumns="False" 
                                      IsReadOnly="True"
                                      GridLinesVisibility="Horizontal"
                                      AlternatingRowBackground="#F8F9FA"
                                      Margin="10">
                                <DataGrid.Columns>
                                    <DataGridTextColumn Header="Роль" Binding="{Binding RoleName}" Width="200"/>
                                    <DataGridTextColumn Header="Описание" Binding="{Binding Description}" Width="*"/>
                                </DataGrid.Columns>
                            </DataGrid>
                        </TabItem>

                        <!-- Роли БД -->
                        <TabItem Header="Роли БД">
                            <DataGrid x:Name="DatabaseRolesGrid"
                                      Style="{DynamicResource MahApps.Styles.DataGrid}"
                                      AutoGenerateColumns="False" 
                                      IsReadOnly="True"
                                      GridLinesVisibility="Horizontal"
                                      AlternatingRowBackground="#F8F9FA"
                                      Margin="10">
                                <DataGrid.Columns>
                                    <DataGridTextColumn Header="Роль БД" Binding="{Binding RoleName}" Width="200"/>
                                    <DataGridTextColumn Header="Владелец" Binding="{Binding Owner}" Width="*"/>
                                </DataGrid.Columns>
                            </DataGrid>
                        </TabItem>
                    </TabControl>
                </Grid>
            </TabItem>




        </TabControl>

        <!-- Статусная строка -->
        <StatusBar Grid.Row="2" Background="#37474F">
            <StatusBarItem>
                <StackPanel Orientation="Horizontal">
                    <iconPacks:PackIconMaterial Kind="CheckCircle" Width="16" Height="16" 
                                                Foreground="#4CAF50" Margin="0,0,5,0"/>
                    <TextBlock x:Name="StatusText" Text="Готов" Foreground="White"/>
                </StackPanel>
            </StatusBarItem>
            <StatusBarItem HorizontalAlignment="Right">
                <TextBlock x:Name="CurrentTimeText" Foreground="#B0BEC5"/>
            </StatusBarItem>
        </StatusBar>
    </Grid>
</Window> 